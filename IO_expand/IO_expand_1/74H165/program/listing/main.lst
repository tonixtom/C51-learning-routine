C51 COMPILER V9.54   MAIN                                                                  07/29/2020 20:54:30 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\main.
                    -lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                            普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名     : 74H165显示试验
   6          * 实验说明       : 使用LED显示74H165的读取值
   7          * 连接方式       : 见连接图
   8          * 注    意     : 
   9          *******************************************************************************/
  10          
  11          #include<reg51.h>
  12          #include<intrins.h>
  13          
  14          //--定义使用的IO口--//
  15          #define GPIO_LED P0
  16          sbit    IN_PL   = P1^6;    //主P1.6 接 CPU P1.4。
  17          sbit    IN_Data = P1^7;    //数据通过P1.7脚移进单片机内处理
  18          sbit    SCK    = P3^6;
  19          
  20          //--声明全局函数--//
  21          unsigned char Read74H165(void);
  22          
  23          /*******************************************************************************
  24          * 函 数 名         : main
  25          * 函数功能       : 主函数
  26          * 输    入         : 无
  27          * 输    出         : 无
  28          *******************************************************************************/
  29          
  30          void main()
  31          {
  32   1        unsigned char h165Value;
  33   1      
  34   1        GPIO_LED = 0;
  35   1        while(1)
  36   1        {
  37   2          h165Value = Read74H165();
  38   2          if(h165Value != 0xFF)
  39   2          {
  40   3            GPIO_LED = ~h165Value;
  41   3          } 
  42   2        } 
  43   1      }
  44          
  45          /*******************************************************************************
  46          * 函 数 名         : Read74H165
  47          * 函数功能       : 使用165读取一个字节数据
  48          * 输    入         : 无
  49          * 输    出         : 无
  50          *******************************************************************************/
  51          
  52          unsigned char Read74H165(void)
  53          {  
  54   1        unsigned char i;
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 20:54:30 PAGE 2   

  55   1        unsigned char indata;
  56   1          
  57   1         IN_PL = 0;
  58   1         _nop_();        //短暂延时 产生一定宽度的脉冲
  59   1         IN_PL = 1;    //将外部信号全部读入锁存器中
  60   1         _nop_(); 
  61   1                    
  62   1         indata=0;   //保存数据的变量清0  
  63   1         for(i=0; i<8; i++)
  64   1          { 
  65   2          indata = indata<<1;    //左移一位
  66   2          SCK = 0;   //时钟置0   
  67   2            _nop_();
  68   2          indata |= IN_Data;
  69   2            SCK = 1;   //时钟置1    
  70   2        } 
  71   1         
  72   1         return(indata);   
  73   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     45    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
