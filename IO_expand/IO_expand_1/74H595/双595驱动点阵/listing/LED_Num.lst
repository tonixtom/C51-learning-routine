C51 COMPILER V9.54   LED_NUM                                                               07/29/2020 21:13:00 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE LED_NUM
OBJECT MODULE PLACED IN .\output\LED_Num.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE LED_Num.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\LE
                    -D_Num.lst) TABS(2) OBJECT(.\output\LED_Num.obj)

line level    source

   1          /*********************************************************************************************
   2          *                                                            *
   3          *                         双595驱动LED点阵实验                         *
   4          *                                                                                          *
   5          * 说明： 点阵的红绿接口分别接在595的输出端口JP2和P595                      *
   6          *   现象：(流动显示1 2 3 4 5 6 7 8 9)                              *
   7          *   实验目的：掌握LED点阵的动作原理和74HC595的级联控制                           *
   8          *             要求学员掌握 LED点阵的工作原理和 各点阵脚的定义及接法，具体接线请参考接线说明  *
   9          **********************************************************************************************/
  10            
  11          #include<reg51.h>
  12          #include <intrins.h>
  13          
  14          #define  NOP() _nop_()  /* 定义空指令 */
  15          
  16          //SPI IO
  17          sbit MOSIO =P3^4;      //定义管脚
  18          sbit R_CLK =P3^5;        //定义管脚
  19          sbit S_CLK =P3^6;        //定义管脚
  20          
  21          void HC595SendData(unsigned int SendVal);   //595驱动函数声明
  22          void delay(unsigned char ms); 
  23            
  24            void main(void)
  25            {
  26   1          while(1)
  27   1          {
  28   2           P0 = 0xff;
  29   2           HC595SendData(0x00ff);
  30   2           delay(250); delay(250);delay(250);delay(250);
  31   2           P0 = 0xff;
  32   2           HC595SendData(0xff00);
  33   2           delay(250);delay(250);delay(250);delay(250);
  34   2           P0 =  0x00;
  35   2           HC595SendData(0x0000);
  36   2           delay(250); delay(250);delay(250);delay(250);
  37   2          }
  38   1      
  39   1          }
  40          /*********************************************************************************************************
  41          ** 函数名称: HC595SendData
  42          ** 功能描述: 向SPI总线发送数据
  43          *********************************************************************************************************/
  44          void HC595SendData(unsigned int SendVal)
  45          {  
  46   1        unsigned char i;
  47   1          
  48   1        for(i=0;i<16;i++) 
  49   1         {
  50   2        if((SendVal<<i)&0x8000) MOSIO=1; //set dataline high  0X8000  最高位与SendVal左移的最高位 进行逻辑运算
  51   2        else MOSIO=0;          // 如果为真 MOSIO = 1  
  52   2       
  53   2        S_CLK=0;
  54   2        NOP();
C51 COMPILER V9.54   LED_NUM                                                               07/29/2020 21:13:00 PAGE 2   

  55   2        NOP();
  56   2        S_CLK=1;  
  57   2         }
  58   1         
  59   1        
  60   1        R_CLK=0; //set dataline low
  61   1        NOP();
  62   1        NOP();
  63   1        R_CLK=1; //片选
  64   1      
  65   1      }
  66          
  67          void delay(unsigned char ms)
  68          {
  69   1        unsigned char i,j;
  70   1        for(i = 0;i < ms;i++)
  71   1          for(j= 0;j<110;j++);
  72   1      }
  73            


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    155    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
