C51 COMPILER V9.01   LCD_DRIVER                                                            12/16/2014 14:17:42 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LCD_DRIVER
OBJECT MODULE PLACED IN lcd_driver.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE lcd_driver.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "lcd_driver.h"
   2          
   3          /****************************************************************************
   4          *函数名：TFT_WriteCmd
   5          *输  入：cmd
   6          *输  出：
   7          *功  能：写命令。
   8          ****************************************************************************/     
   9          
  10          void TFT_WriteCmd(uint cmd)
  11          {
  12   1              uchar cmdH, cmdL;
  13   1              cmdH = cmd >> 8;
  14   1              cmdL = cmd & 0x00FF;
  15   1      
  16   1              TFT_WR = 1;                       //初始化WR
  17   1              TFT_CS = 0;                       //打开片选
  18   1              
  19   1              TFT_RD = 1;           //选择写
  20   1              TFT_RS = 0;                       //选择命令
  21   1                      
  22   1              TFT_DATAPORTH = cmdH; //放置命令数据
  23   1              TFT_DATAPORTL = cmdL; //放置命令数据
  24   1      
  25   1              TFT_WR = 0;                       //写入时序
  26   1              TFT_WR = 1;
  27   1              
  28   1              TFT_CS = 1;                       //关闭片选
  29   1      }
  30          
  31          /****************************************************************************
  32          *函数名：TFT_WriteCmdData
  33          *输  入：cmd, dat
  34          *输  出：
  35          *功  能：写命令， 写数据。
  36          ****************************************************************************/     
  37          
  38          void TFT_WriteData(uint dat)
  39          {
  40   1          uchar datH, datL;
  41   1              datH = dat >> 8;
  42   1              datL = dat & 0x00FF;
  43   1      
  44   1              TFT_WR = 1;                       //初始化WR
  45   1              TFT_CS = 0;                       //打开片选
  46   1              
  47   1              TFT_RD = 1;           //选择写
  48   1              TFT_RS = 1;                       //选择发送数据
  49   1                      
  50   1              TFT_DATAPORTH = datH;  //放置命令数据
  51   1              TFT_DATAPORTL = datL;  //放置命令数据
  52   1      
  53   1              TFT_WR = 0;                       //写入时序
  54   1              TFT_WR = 1;
  55   1              
C51 COMPILER V9.01   LCD_DRIVER                                                            12/16/2014 14:17:42 PAGE 2   

  56   1              TFT_CS = 1;                       //关闭片选
  57   1      }
  58          
  59          /****************************************************************************
  60          *函数名：TFT_Init
  61          *输  入：
  62          *输  出：
  63          *功  能：初始化TFT。
  64          ****************************************************************************/     
  65          
  66          void TFT_Init(void)
  67          {
  68   1              uint i;
  69   1      
  70   1              TFT_RST = 1;
  71   1              for(i=500; i>0; i--);
  72   1              TFT_RST = 0;
  73   1              for(i=500; i>0; i--);
  74   1              TFT_RST = 1;
  75   1              for(i=5000; i>0; i--);
  76   1              
  77   1               TFT_CS = 0;
  78   1               TFT_WriteCmd(0x0014);TFT_WriteData(0x0030); 
  79   1               TFT_WriteCmd(0x000F);TFT_WriteData(0x0008);  
  80   1               TFT_WriteCmd(0x0011);TFT_WriteData(0x0231);  
  81   1               TFT_WriteCmd(0x0012);TFT_WriteData(0x0009);  
  82   1               TFT_WriteCmd(0x0013);TFT_WriteData(0x1448);  
  83   1               TFT_WriteCmd(0x0010);TFT_WriteData(0x5268);  
  84   1               for(i=500; i>0; i--);  
  85   1               TFT_WriteCmd(0x0012);TFT_WriteData(0x0019);  
  86   1               for(i=500; i>0; i--);  
  87   1               TFT_WriteCmd(0x0010);TFT_WriteData(0x5260);  
  88   1               TFT_WriteCmd(0x0013);TFT_WriteData(0x2d48);  
  89   1               for(i=500; i>0; i--);  
  90   1               TFT_WriteCmd(0x0030);TFT_WriteData(0x0000); 
  91   1               TFT_WriteCmd(0x0031);TFT_WriteData(0x0501);  
  92   1               TFT_WriteCmd(0x0032);TFT_WriteData(0x0207);  
  93   1               TFT_WriteCmd(0x0033);TFT_WriteData(0x0502);  
  94   1               TFT_WriteCmd(0x0034);TFT_WriteData(0x0007);  
  95   1               TFT_WriteCmd(0x0035);TFT_WriteData(0x0601);  
  96   1               TFT_WriteCmd(0x0036);TFT_WriteData(0x0707);  
  97   1               TFT_WriteCmd(0x0037);TFT_WriteData(0x0305);  
  98   1               TFT_WriteCmd(0x0038);TFT_WriteData(0x040e);  
  99   1               TFT_WriteCmd(0x0039);TFT_WriteData(0x040e); 
 100   1      
 101   1               TFT_WriteCmd(0x003a);TFT_WriteData(0x0101);  
 102   1               TFT_WriteCmd(0x003b);TFT_WriteData(0x0101);  
 103   1               TFT_WriteCmd(0x003c);TFT_WriteData(0x0101);  
 104   1               TFT_WriteCmd(0x003d);TFT_WriteData(0x0101);  
 105   1               TFT_WriteCmd(0x003e);TFT_WriteData(0x0001);  
 106   1               TFT_WriteCmd(0x003f);TFT_WriteData(0x0001);
 107   1       
 108   1               TFT_WriteCmd(0x0001);TFT_WriteData(0x011B);  
 109   1               TFT_WriteCmd(0x0002);TFT_WriteData(0x0700);  
 110   1               TFT_WriteCmd(0x0003);TFT_WriteData(0x1030);  
 111   1               TFT_WriteCmd(0x0008);TFT_WriteData(0x1010);  
 112   1               TFT_WriteCmd(0x000A);TFT_WriteData(0x4420);  
 113   1               TFT_WriteCmd(0x000B);TFT_WriteData(0x5030);  
 114   1               TFT_WriteCmd(0x0007);TFT_WriteData(0x0005);  
 115   1               TFT_WriteCmd(0x0007);TFT_WriteData(0x0025);  
 116   1               TFT_WriteCmd(0x0007);TFT_WriteData(0x0027);  
 117   1               TFT_WriteCmd(0x0007);TFT_WriteData(0x0037); 
C51 COMPILER V9.01   LCD_DRIVER                                                            12/16/2014 14:17:42 PAGE 3   

 118   1      
 119   1               TFT_WriteCmd(0x44);TFT_WriteData(0xaf00);
 120   1               TFT_WriteCmd(0x45);TFT_WriteData(0xdb00);
 121   1              
 122   1               TFT_WriteCmd(0x20);TFT_WriteData(0x0000);
 123   1               TFT_WriteCmd(0x21);TFT_WriteData(0x0000);  
 124   1               TFT_WriteCmd(0x22);
 125   1      }
 126          
 127          /****************************************************************************
 128          *函数名：TFT_SetWindow
 129          *输  入：xStart, yStart, xEnd, yEnd
 130          *输  出：
 131          *功  能：设置要操作的窗口。
 132          ****************************************************************************/     
 133          
 134          void TFT_SetWindow(uchar xStart, uchar yStart, uchar xEnd, uchar yEnd)
 135          {
 136   1               uint x,y,xy;
 137   1      
 138   1               x=(xEnd <<8)|xStart;
 139   1               y=(yEnd <<8)|yStart;
 140   1               xy = (yStart<<8)|xStart;
 141   1      
 142   1               TFT_WriteCmd(0x44);TFT_WriteData(x);
 143   1               TFT_WriteCmd(0x45);TFT_WriteData(y);
 144   1               TFT_WriteCmd(0x21);TFT_WriteData(xy);
 145   1      
 146   1      
 147   1               /*TFT_WriteCmd(0x20);TFT_WriteData(xStart);   //xStart
 148   1               TFT_WriteCmd(0x21);TFT_WriteData(yStart);   //yStart
 149   1               */
 150   1               TFT_WriteCmd(0x22); 
 151   1      }
 152          
 153          
 154          /****************************************************************************
 155          *函数名：GUI_Clearcreen
 156          *输  入：backColor
 157          *输  出：
 158          *功  能：清屏并涂上颜色。
 159          ****************************************************************************/
 160                    
 161          void TFT_ClearScreen(uint color)
 162          {
 163   1              uint i, j;
 164   1      
 165   1              TFT_SetWindow(0, 0, TFT_XMAX, TFT_YMAX);         //作用区域
 166   1              for(i=0; i<=TFT_XMAX; i++)
 167   1              {
 168   2                      for (j=0; j<=TFT_YMAX; j++)
 169   2                      {
 170   3                              TFT_WriteData(color);
 171   3                      }
 172   2              }
 173   1      }
 174          
 175          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    764    ----
C51 COMPILER V9.01   LCD_DRIVER                                                            12/16/2014 14:17:42 PAGE 4   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
