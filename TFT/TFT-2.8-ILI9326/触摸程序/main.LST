C51 COMPILER V9.01   MAIN                                                                  01/06/2015 13:47:37 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "REG51.H"
   2          #include "gui.h"
   3          #include "touch.h"
   4          #include "lcd_drive.h"
   5          
   6          
   7          void main (void)
   8          {
   9   1              uchar rst = 0;
  10   1              //--多出来两个值使用来在内存上面跟别的变量分隔的--//
  11   1              uchar  xValue[6] = {0, 0, 0, 0, 0, 0}, yValue[6] = {0, 0, 0, 0, 0, 0};
  12   1              long x, y;
  13   1      
  14   1              TFT_Init();
  15   1              rst = 1;
  16   1      
  17   1              while(1)
  18   1              {
  19   2                      if(rst == 1)
  20   2                      {       
  21   3                              TFT_ClearScreen(0x0000);
  22   3                              GUI_Write32CnChar(60, 24, "普中科技", 0xF800, 0x0000);
  23   3                              GUI_Line(60, 54, 180, 54, 0xF800);
  24   3                              GUI_Line(60, 54, 180, 54, 0xF800);
  25   3                              GUI_WriteASCII(190, 0, "RST", 0xF800, 0x0000);
  26   3                              rst = 0;
  27   3                      }
  28   2      
  29   2                      if(TOUCH_XPT_ReadXY() == 1)
  30   2                      {
  31   3                              //--如果触摸跟显示发生偏移，可以根据显示AD值--//
  32   3                              //--调整下面公式里面的数值--//
  33   3                              x = xpt_xy.x;
  34   3                              x = (x - 304)*239/3392; 
  35   3                              y =     xpt_xy.y;
  36   3                              y = (y - 192) *431/3744;
  37   3      
  38   3      
  39   3      
  40   3                              if (x > 240 )
  41   3                              {
  42   4                                      x = 240;
  43   4                              }
  44   3                              if (y > 432)
  45   3                              {
  46   4                                      y = 432;
  47   4                              }
  48   3                              if ((x > 190) && (y < 27))
  49   3                              {
  50   4                                      rst = 1;
  51   4                              }
  52   3                              else
  53   3                              {
  54   4                                      GUI_Dot((uint)x , (uint)y, 0x001F);
  55   4                                      //--计算读取到的AD值--//
C51 COMPILER V9.01   MAIN                                                                  01/06/2015 13:47:37 PAGE 2   

  56   4                                      //--由于添加了显示AD值，计算需要时间，所以触摸有一点延迟--//xpt_xy.
  57   4                                      xValue[1] = (xpt_xy.x % 10000 /1000) + '0';
  58   4                                      xValue[2] = (xpt_xy.x % 1000 /100) + '0';
  59   4                                      xValue[3] = (xpt_xy.x % 100 /10) + '0';
  60   4                                      xValue[4] = (xpt_xy.x % 10) + '0';
  61   4      
  62   4                                      yValue[1] = (xpt_xy.y % 10000 /1000) + '0';
  63   4                                      yValue[2] = (xpt_xy.y % 1000 /100) + '0';
  64   4                                      yValue[3] = (xpt_xy.y % 100 /10) + '0';
  65   4                                      yValue[4] = (xpt_xy.y % 10) + '0';
  66   4      
  67   4                                      //--显示AD值--//
  68   4                                      GUI_WriteASCII(0, 170, "X:", 0xF800, 0x0000);
  69   4                                      GUI_WriteASCII(32, 170, &xValue[1], 0xF800, 0x0000);    
  70   4                                      GUI_WriteASCII(0, 195, "Y:", 0xF800, 0x0000);
  71   4                                      GUI_WriteASCII(32, 195, &yValue[1], 0xF800, 0x0000);
  72   4                              }
  73   3                      }
  74   2              }
  75   1      }
  76          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    700    ----
   CONSTANT SIZE    =     31    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      21
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
