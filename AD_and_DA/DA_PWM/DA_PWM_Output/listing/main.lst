C51 COMPILER V9.54   MAIN                                                                  07/14/2020 22:51:38 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\main.
                    -lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          #include <reg52.h>
   2          
   3          //--定义使用的IO口--//
   4          sbit PWM=P2^1;
   5          bit DIR;
   6          
   7          //--定义一个全局变量--// 
   8          unsigned int count,value,timer1;
   9          
  10          void Time1Config();
  11          
  12          /*******************************************************************************
  13          * 函 数 名       : main
  14          * 函数功能     : 主函数
  15          * 输    入       : 无
  16          * 输    出       : 无
  17          *******************************************************************************/
  18          
  19          void main(void)
  20          {
  21   1        Time1Config();
  22   1        while(1)
  23   1        {  
  24   2          if(count>100)             
  25   2          {  
  26   3            count=0;
  27   3            if(DIR==1)             //DIR控制增加或减小
  28   3            {
  29   4              value++;
  30   4            }     
  31   3            if(DIR==0)
  32   3            {
  33   4              value--;
  34   4            }
  35   3              
  36   3          }
  37   2      
  38   2          if(value==1000)
  39   2          {
  40   3            DIR=0;
  41   3          }
  42   2          if(value==0)
  43   2          {
  44   3            DIR=1;
  45   3          } 
  46   2              
  47   2          if(timer1>1000)  //PWM周期为100*1us
  48   2          {
  49   3            timer1=0;
  50   3          }
  51   2          if(timer1 <value) 
  52   2          {
  53   3            PWM=1;
  54   3          }
C51 COMPILER V9.54   MAIN                                                                  07/14/2020 22:51:38 PAGE 2   

  55   2          else
  56   2          {
  57   3            PWM=0;
  58   3          }
  59   2        }
  60   1        
  61   1      
  62   1       }
  63          
  64          /*******************************************************************************
  65          * 函 数 名       : Time1Config
  66          * 函数功能     : 设置定时器
  67          * 输    入       : 无
  68          * 输    出       : 无
  69          *******************************************************************************/
  70          
  71          void Time1Config()
  72          {
  73   1        TMOD|= 0x10;   //设置定时计数器工作方式1为定时器
  74   1      
  75   1        //--定时器赋初始值，12MHZ下定时1us--//  
  76   1        TH1 = 0xFF; 
  77   1        TL1 = 0xff;
  78   1      
  79   1        
  80   1        ET1 = 1;   //开启定时器1中断
  81   1        EA = 1;
  82   1        TR1 = 1;   //开启定时器 
  83   1      }
  84          
  85          /*******************************************************************************
  86          * 函 数 名       : Time1
  87          * 函数功能     : 定时器1的中断函数
  88          * 输    入       : 无
  89          * 输    出       : 无
  90          *******************************************************************************/
  91          
  92          void Time1(void) interrupt 3    //3 为定时器1的中断号  1 定时器0的中断号 0 外部中断1 2 外部中断2  4 串口中
             -断
  93          {
  94   1        TH1 = 0xFF;  //重新赋初值
  95   1        TL1 = 0xFf;
  96   1        timer1++; 
  97   1          count++;
  98   1        
  99   1      }
 100          
 101          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    139    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
