C51 COMPILER V9.01   LED_DISPLAY                                                           01/14/2014 09:33:38 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LED_DISPLAY
OBJECT MODULE PLACED IN LED_display.OBJ
COMPILER INVOKED BY: D:\KEIL\C51\BIN\C51.EXE LED_display.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                                      普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名               : LED点阵刷屏
   6          * 实验说明       : 
   7          * 连接方式       : 见接线图
   8          * 注    意               : 
   9          *******************************************************************************/
  10          
  11          #include <REG51.H>
  12          
  13          //--重定义函数变量--//
  14          #define uchar unsigned char
  15          #define uint  unsigned int
  16          #define ulong unsigned long
  17          
  18          //--定义SPI要使用的 IO--//
  19          sbit MOSIO = P3^4;
  20          sbit R_CLK = P3^5;
  21          sbit S_CLK = P3^6;
  22          
  23          //函数声明
  24          void HC595SendData( uchar BT3, uchar BT2,uchar BT1,uchar BT0);
  25                                                                                                                                                                                                          
  26          /*******************************************************************************
  27          * 函 数 名         : main
  28          * 函数功能                 : 主函数
  29          * 输    入         : 无
  30          * 输    出         : 无
  31          *******************************************************************************/
  32          
  33          void main(void)
  34          {
  35   1              uint i , j;
  36   1              uchar b1;
  37   1      
  38   1              while(1)
  39   1              {
  40   2                       //--全亮--//
  41   2                      HC595SendData(0x00, 0x00, 0xFF, 0xFF);
  42   2                      for(j=0; j<50000; j++);
  43   2                      
  44   2                      //--刷行--//    
  45   2                      b1 = 0x01;
  46   2                      for(i = 0; i<8; i++)
  47   2                      {
  48   3                              HC595SendData(0x00, 0x00, 0x00, b1);
  49   3                              b1 <<= 1;
  50   3                              for(j=0; j<20000; j++);
  51   3                      }
  52   2      
  53   2                      b1 = 0x01;
  54   2                      for(i = 0; i<8; i++)
  55   2                      {
C51 COMPILER V9.01   LED_DISPLAY                                                           01/14/2014 09:33:38 PAGE 2   

  56   3                              HC595SendData(0x00, 0x00, b1, 0x00);
  57   3                              b1 <<= 1;
  58   3                              for(j=0; j<20000; j++);
  59   3                      }
  60   2      
  61   2                      //--刷列--//
  62   2                      b1 = 0x01;
  63   2                      for(i = 0; i<8; i++)
  64   2                      {
  65   3                              HC595SendData(0xFF, ~b1, 0xFF, 0xFF);
  66   3                              b1 <<= 1;
  67   3                              for(j=0; j<20000; j++);
  68   3                      }
  69   2      
  70   2                      b1 = 0x01;
  71   2                      for(i = 0; i<8; i++)
  72   2                      {
  73   3                              HC595SendData(~b1, 0xFF, 0xFF, 0xFF);
  74   3                              b1 <<= 1;
  75   3                              for(j=0; j<20000; j++);
  76   3                      }       
  77   2                      
  78   2      
  79   2              }
  80   1      }
  81          
  82          
  83          /*******************************************************************************
  84          * 函 数 名         : HC595SendData
  85          * 函数功能                 : 通过595发送四个字节的数据
  86          * 输    入         : BT3：第四个595输出数值
  87          *                  * BT2: 第三个595输出数值
  88          *                  * BT1：第二个595输出数值
  89          *                  * BT0：第一个595输出数值
  90          * 输    出         : 无
  91          *******************************************************************************/
  92          
  93          void HC595SendData(  uchar BT3, uchar BT2,uchar BT1,uchar BT0)
  94          {  
  95   1              uchar i;
  96   1              
  97   1              //--发送第一个字节--//
  98   1              for(i=0;i<8;i++)
  99   1              {
 100   2                      MOSIO = BT3 >> 7 ;      //从高位到低位
 101   2                      BT3 <<= 1;
 102   2      
 103   2                      S_CLK = 0;
 104   2                      S_CLK = 1;              
 105   2              }
 106   1      
 107   1              //--发送第一个字节--//
 108   1              for(i=0;i<8;i++)
 109   1              {
 110   2                      MOSIO = BT2 >>7;                //从高位到低位
 111   2                      BT2 <<= 1;
 112   2      
 113   2                      S_CLK = 0;
 114   2                      S_CLK = 1;      
 115   2              }
 116   1      
 117   1              //--发送第一个字节--//
C51 COMPILER V9.01   LED_DISPLAY                                                           01/14/2014 09:33:38 PAGE 3   

 118   1              for(i=0;i<8;i++)
 119   1              {
 120   2                      MOSIO = BT1 >> 7;               //从高位到低位
 121   2                      BT1 <<= 1;
 122   2                      S_CLK = 0;
 123   2                      S_CLK = 1;      
 124   2              }
 125   1      
 126   1              //--发送第一个字节--//
 127   1              for(i=0;i<8;i++)
 128   1              {
 129   2                      MOSIO = BT0 >> 7;               //从高位到低位
 130   2                      BT0 <<= 1;
 131   2                      S_CLK = 0;
 132   2                      S_CLK = 1;
 133   2              }
 134   1         
 135   1              //--输出--//
 136   1              R_CLK = 0; //set dataline low
 137   1              R_CLK = 1; //片选
 138   1              R_CLK = 0; //set dataline low
 139   1      }
 140          
 141          
 142          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    389    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
