C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:22 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LATTICE
OBJECT MODULE PLACED IN Lattice.OBJ
COMPILER INVOKED BY: D:\KEIL\C51\BIN\C51.EXE Lattice.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                                      普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名               : LED点阵显示汉字
   6          * 实验说明       : 
   7          * 连接方式       : 见接线图
   8          * 注    意               : 
   9          *******************************************************************************/
  10          
  11          #include <REG51.H>
  12          #include <intrins.h>
  13          #define  NOP() _nop_()  // 定义空指令 ，这个函数在库 <intrins.h> 中
  14          
  15          //--重定义函数变量--//
  16          #define uchar unsigned char
  17          #define uint  unsigned int
  18          #define ulong unsigned long
  19          
  20          //--定义SPI要使用的 IO--//
  21          sbit MOSIO = P3^4;
  22          sbit R_CLK = P3^5;
  23          sbit S_CLK = P3^6;
  24          
  25          //---全局变量声明--//
  26          ulong column;   //点阵列
  27          ulong row;      //点阵行
  28          ulong dt;
  29          
  30          //点阵显示数组
  31          uchar code tab0[] = {0x00, 0x01, 0x00, 0x02, 0x00, 0x04, 0x00, 0x08, 0x00, 0x10, 0x00, 0x20, 0x00, 0x40, 0
             -x00, 0x80,
  32                                       0x01, 0x00, 0x02, 0x00, 0x04, 0x00, 0x08, 0x00, 0x10, 0x00, 0x20, 0x00, 0x40,
             - 0x00, 0x80, 0x00}; 
  33          //--亲--//
  34          uchar code tab1[] = {
  35          64,0,128,8,254,31,16,2,32,1,255,63,64,0,64,0,
  36          254,31,64,0,72,6,68,8,82,16,32,0,0,0,0,0};
  37          //--爱--//
  38          uchar code tab2[] = {
  39          0,14,252,1,72,8,144,4,254,63,2,16,33,8,252,
  40          31,32,0,224,7,80,2,136,1,68,2,58,28,0,0,0,0};
  41          //--的--//
  42          uchar code tab3[] = {
  43          8,2,8,2,4,17,62,63,162,16,98,16,34,17,62,
  44          18,34,18,34,16,34,16,34,16,62,10,34,4,0,0,0,0};
  45          //--顾--//
  46          uchar code tab4[] = {
  47          0,16,190,63,2,2,186,31,170,16,170,20,170,20,186,20,
  48          138,20,138,20,170,20,26,10,1,49,193,32,0,0,0,0};
  49          //--客--//
  50          uchar code tab5[] = {
  51          64,0,128,0,254,31,34,16,241,11,40,2,68,1,192,1,32,
  52          2,248,63,23,4,16,4,16,4,240,7,0,0,0,0};
  53          //--欢--//
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:22 PAGE 2   

  54          uchar code tab6[] = {
  55          0,1,0,1,63,1,32,63,162,32,148,18,84,2,8,2,
  56          8,2,20,5,36,5,162,8,65,16,32,32,0,0,0,0};
  57          //--迎--//
  58          uchar code tab7[] = {
  59          2,1,196,16,36,62,32,18,32,18,39,18,36,18,164,18,
  60          100,18,36,26,4,2,10,2,49,0,192,63,0,0,0,0};
  61          //--使--//
  62          uchar code tab8[] = {
  63          16,2,16,18,232,63,8,2,204,31,74,18,73,18,200,31,
  64          8,18,72,2,136,2,8,1,136,6,104,56,0,0,0,0};
  65          //--用--//
  66          uchar code tab9[] = {
  67          0,8,252,31,132,8,132,8,252,15,132,8,132,8,132,8,
  68          252,15,132,8,132,8,130,8,130,10,129,4,0,0,0,0};
  69          //--开--//
  70          uchar code tab10[] = {
  71          0,8,254,31,16,2,16,2,16,2,16,18,255,63,16,2,
  72          16,2,16,2,16,2,8,2,4,2,3,2,0,0,0,0};
  73          //--发--//
  74          uchar code tab11[] = {
  75          32,2,36,4,36,4,34,16,254,63,32,0,224,15,80,8,
  76          80,4,136,2,8,1,132,2,98,60,29,16,0,0,0,0};
  77          //--板--//
  78          uchar code tab12[] = {
  79          4,8,4,30,196,1,95,0,196,15,68,8,78,9,86,9,
  80          69,5,69,5,68,2,36,5,164,56,84,16,0,0,0,0};
  81          //--∩_∩--//
  82          uchar code tab13[] = {
  83          0,0,0,0,60,240,102,156,67,130,0,0,0,0,0,0,
  84          0,0,0,0,48,24,96,8,192,7,0,0,0,0,0,0};
  85          
  86          //函数声明
  87          void HC595SendData(  uchar BT3, uchar BT2,uchar BT1,uchar BT0);
  88                                                                                                                                                                                                  
  89          /*************主函数*****************************/      
  90          void main(void)
  91          {
  92   1         int k, i, ms;
  93   1         i = 80;                                                              //显示时间
  94   1         while(1)
  95   1         {
  96   2              //--显示"亲"--//
  97   2                      for(ms = i; ms > 0; ms--)
  98   2                      {
  99   3                              for(k = 0; k < 16; k++)                                                                         
 100   3                              {        
 101   4                              HC595SendData(~tab1[2*k +1],~tab1[2*k],tab0[2*k],tab0[2*k + 1]);
 102   4                              }                
 103   3                      }
 104   2              
 105   2                      //--清屏--//
 106   2                      HC595SendData(0xff,0xff,0,0);                                                                                                                                       
 107   2                      
 108   2                      //--显示“爱”--//
 109   2                      for(ms = i; ms > 0; ms--)
 110   2                      {
 111   3                              for(k = 0; k < 16; k++)                                                                                     
 112   3                              {        
 113   4                                      HC595SendData(~tab2[2*k +1],~tab2[2*k],tab0[2*k],tab0[2*k + 1]);                 
 114   4                              }
 115   3                      }
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:22 PAGE 3   

 116   2              
 117   2                      //--清屏--//
 118   2                      HC595SendData(0xff,0xff,0,0);                                                                   
 119   2                      
 120   2                      //--显示“的”--//
 121   2                      for(ms = i; ms > 0; ms--)
 122   2                      {
 123   3                              for(k = 0; k < 16; k++)                                                                                         
 124   3                              {        
 125   4                                      HC595SendData(~tab3[2*k +1],~tab3[2*k],tab0[2*k],tab0[2*k + 1]);                 
 126   4                              }
 127   3                      }
 128   2                      
 129   2                      //--清屏--//    
 130   2                      HC595SendData(0xff,0xff,0,0);   
 131   2                      
 132   2                      //--显示“顾”--//
 133   2                      for(ms = i; ms > 0; ms--)
 134   2                      {
 135   3                              for(k = 0; k < 16; k++)                                         
 136   3                              {        
 137   4                                      HC595SendData(~tab4[2*k +1],~tab4[2*k],tab0[2*k],tab0[2*k + 1]);                 
 138   4                              }
 139   3                      }
 140   2                      
 141   2                      //--清屏--//    
 142   2                      HC595SendData(0xff,0xff,0,0);                                                                           
 143   2                                                                                                                                                               
 144   2                      //--显示“客”--//
 145   2                      for(ms = i; ms > 0; ms--)
 146   2                      {
 147   3                              for(k = 0; k < 16; k++)                                                                                         
 148   3                              {        
 149   4                                      HC595SendData(~tab5[2*k +1],~tab5[2*k],tab0[2*k],tab0[2*k + 1]);                 
 150   4                              }
 151   3                      }
 152   2                      
 153   2                      //--清屏--//    
 154   2                      HC595SendData(0xff,0xff,0,0);                                                                           
 155   2              
 156   2                  //--显示“欢”--//
 157   2                      for(ms = i; ms > 0; ms--)
 158   2                      {
 159   3                              for(k = 0; k < 16; k++)                                                                                         //欢
 160   3                              {        
 161   4                                      HC595SendData(~tab6[2*k +1],~tab6[2*k],tab0[2*k],tab0[2*k + 1]);                 
 162   4                              }
 163   3                      }
 164   2      
 165   2                      //--清屏--//    
 166   2                      HC595SendData(0xff,0xff,0,0);                                           
 167   2              
 168   2                  //--显示“迎”--//
 169   2                      for(ms = i; ms > 0; ms--)
 170   2                      {
 171   3                              for(k = 0; k < 16; k++)                                                 
 172   3                              {        
 173   4                                      HC595SendData(~tab7[2*k +1],~tab7[2*k],tab0[2*k],tab0[2*k + 1]);                 
 174   4                              }
 175   3                      }
 176   2      
 177   2                      //--清屏--//    
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:22 PAGE 4   

 178   2                      HC595SendData(0xff,0xff,0,0);                                       
 179   2                      
 180   2                      //--显示“使”--//
 181   2                      for(ms = i; ms > 0; ms--)
 182   2                      {
 183   3                              for(k = 0; k < 16; k++)                                                 
 184   3                              {        
 185   4                                      HC595SendData(~tab8[2*k +1],~tab8[2*k],tab0[2*k],tab0[2*k + 1]);                 
 186   4                              }
 187   3                      }
 188   2      
 189   2                      //--清屏--//    
 190   2                      HC595SendData(0xff,0xff,0,0);                                                           
 191   2                      
 192   2                      //--显示“用”--//      
 193   2                      for(ms = i; ms > 0; ms--)
 194   2                      {
 195   3                              for(k = 0; k < 16; k++)                                         
 196   3                              {        
 197   4                                      HC595SendData(~tab9[2*k +1],~tab9[2*k],tab0[2*k],tab0[2*k + 1]);                 
 198   4                              }
 199   3                      }
 200   2      
 201   2                      //--清屏--//    
 202   2                      HC595SendData(0xff,0xff,0,0);
 203   2                      //--显示“开”--//      
 204   2                      for(ms = i; ms > 0; ms--)
 205   2                      {
 206   3                              for(k = 0; k < 16; k++)                                         
 207   3                              {        
 208   4                                      HC595SendData(~tab10[2*k +1],~tab10[2*k],tab0[2*k],tab0[2*k + 1]);               
 209   4                              }
 210   3                      }
 211   2      
 212   2                      //--清屏--//    
 213   2                      HC595SendData(0xff,0xff,0,0);
 214   2                      //--显示“发”--//      
 215   2                      for(ms = i; ms > 0; ms--)
 216   2                      {
 217   3                              for(k = 0; k < 16; k++)                                         
 218   3                              {        
 219   4                                      HC595SendData(~tab11[2*k +1],~tab11[2*k],tab0[2*k],tab0[2*k + 1]);               
 220   4                              }
 221   3                      }
 222   2      
 223   2                      //--清屏--//    
 224   2                      HC595SendData(0xff,0xff,0,0);
 225   2       
 226   2                      //--显示"板"--//        
 227   2                      for(ms = i; ms > 0; ms--)
 228   2                      {
 229   3                              for(k = 0; k < 16; k++)                                         
 230   3                              {        
 231   4                                      HC595SendData(~tab12[2*k +1],~tab12[2*k],tab0[2*k],tab0[2*k + 1]);               
 232   4                              }
 233   3                      }
 234   2      
 235   2                      //--清屏--//    
 236   2                      HC595SendData(0xff,0xff,0,0);
 237   2      
 238   2                      //--显示"∩_∩"--//     
 239   2                      for(ms = i; ms > 0; ms--)
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:22 PAGE 5   

 240   2                      {
 241   3                              for(k = 0; k < 16; k++)                                         
 242   3                              {        
 243   4                                      HC595SendData(~tab13[2*k +1],~tab13[2*k],tab0[2*k],tab0[2*k + 1]);               
 244   4                              }
 245   3                      }
 246   2      
 247   2                      //--清屏--//    
 248   2                      HC595SendData(0xff,0xff,0,0);   
 249   2         }
 250   1      }
 251          
 252          /*******************************************************************************
 253          * 函 数 名         : HC595SendData
 254          * 函数功能                 : 通过595发送四个字节的数据
 255          * 输    入         : BT3：第四个595输出数值
 256          *                  * BT2: 第三个595输出数值
 257          *                  * BT1：第二个595输出数值
 258          *                  * BT0：第一个595输出数值
 259          * 输    出         : 无
 260          *******************************************************************************/
 261          
 262          void HC595SendData(  uchar BT3, uchar BT2,uchar BT1,uchar BT0)
 263          {  
 264   1              uchar i;
 265   1              
 266   1              //--发送第一个字节--//
 267   1              for(i=0;i<8;i++)
 268   1              {
 269   2                      MOSIO = BT3 >> 7 ;      //从高位到低位
 270   2                      BT3 <<= 1;
 271   2      
 272   2                      S_CLK = 0;
 273   2                      S_CLK = 1;              
 274   2              }
 275   1      
 276   1              //--发送第一个字节--//
 277   1              for(i=0;i<8;i++)
 278   1              {
 279   2                      MOSIO = BT2 >>7;                //从高位到低位
 280   2                      BT2 <<= 1;
 281   2      
 282   2                      S_CLK = 0;
 283   2                      S_CLK = 1;      
 284   2              }
 285   1      
 286   1              //--发送第一个字节--//
 287   1              for(i=0;i<8;i++)
 288   1              {
 289   2                      MOSIO = BT1 >> 7;               //从高位到低位
 290   2                      BT1 <<= 1;
 291   2                      S_CLK = 0;
 292   2                      S_CLK = 1;      
 293   2              }
 294   1      
 295   1              //--发送第一个字节--//
 296   1              for(i=0;i<8;i++)
 297   1              {
 298   2                      MOSIO = BT0 >> 7;               //从高位到低位
 299   2                      BT0 <<= 1;
 300   2                      S_CLK = 0;
 301   2                      S_CLK = 1;
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:22 PAGE 6   

 302   2              }
 303   1         
 304   1              //--输出--//
 305   1              R_CLK = 0; //set dataline low
 306   1              R_CLK = 1; //片选
 307   1              R_CLK = 0; //set dataline low
 308   1      }
 309          
 310          
 311          
 312          
 313          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1895    ----
   CONSTANT SIZE    =    448    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
