C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:03:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\main.
                    -lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          //
   2          /*******************************************************************************
   3          * 实验名         : 动态显示数码管实验
   4          * 使用的IO       : 
   5          * 实验效果       : 数码管显示76543210。
   6          * 注意           ：当位选用P1口的时候注意可能会有一位不亮，那么调整J21
   7          *******************************************************************************/
   8          #include<reg51.h>
   9          
  10          //--定义使用的IO口--//
  11          #define GPIO_DIG   P0
  12          #define GPIO_PLACE P1
  13          
  14          #define GPIO_TRAFFIC P2
  15          
  16          sbit RED10   = P2^0;   //上人行道红灯
  17          sbit GREEN10 = P2^1;   //上人行道绿灯
  18          sbit RED11   = P2^2;
  19          sbit YELLOW11= P2^3;
  20          sbit GREEN11 = P2^4;
  21          
  22          sbit RED00   = P3^0;  //右人行道红灯
  23          sbit GREEN00 = P3^1;  //右人行道绿灯
  24          sbit RED01   = P2^5;
  25          sbit YELLOW01= P2^6;
  26          sbit GREEN01 = P2^7;
  27          
  28          //--定义全局变量--//
  29          unsigned char code DIG_PLACE[8] = {
  30          0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};//位选控制   查表的方法控制
  31          unsigned char code DIG_CODE[17] = {
  32          0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,
  33          0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  34          //0、1、2、3、4、5、6、7、8、9、A、b、C、d、E、F的显示码
  35          unsigned char DisplayData[8];
  36          //用来存放要显示的8位数的值
  37          unsigned char Time, Second;     //用来存放定时时间
  38          
  39          //--声明全局函数--//
  40          void DigDisplay(); //动态显示函数
  41          void Timer0Cofig(void);
  42          
  43          /*******************************************************************************
  44          * 函 数 名         : main
  45          * 函数功能       : 主函数
  46          * 输    入         : 无
  47          * 输    出         : 无
  48          *******************************************************************************/
  49          
  50          void main(void)
  51          {
  52   1        Second = 1;
  53   1      
  54   1        Timer0Cofig();
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:03:08 PAGE 2   

  55   1      
  56   1        while(1)
  57   1        {
  58   2          if(Second == 70)
  59   2          {
  60   3            Second = 1;
  61   3          }
  62   2      
  63   2          //--宝田路通行，30秒--//
  64   2          if(Second < 31)
  65   2          {
  66   3            DisplayData[0] = 0x00;
  67   3            DisplayData[1] = 0x00;
  68   3            DisplayData[2] = DIG_CODE[(30 - Second) % 100 / 10];
  69   3            DisplayData[3] = DIG_CODE[(30 - Second) %10];
  70   3            DisplayData[4] = 0x00;
  71   3            DisplayData[5] = 0x00;
  72   3            DisplayData[6] = DisplayData[2];
  73   3            DisplayData[7] = DisplayData[3];
  74   3            DigDisplay();
  75   3      
  76   3            //--宝田路通行--//
  77   3      
  78   3            GPIO_TRAFFIC = 0xFF;  //将所有的灯熄灭
  79   3            RED00 = 1;
  80   3            GREEN00 = 1;
  81   3      
  82   3            GREEN11 = 0;    //宝田路绿灯亮      
  83   3            GREEN10 = 0;    //宝田路人行道绿灯亮
  84   3      
  85   3            RED01 = 0;      //前进路红灯亮
  86   3            RED00 = 0;      //前进路人行道红灯亮
  87   3          }
  88   2      
  89   2          //--黄灯等待切换状态，5秒--//
  90   2          else if(Second < 36) 
  91   2          {
  92   3            DisplayData[0] = 0x00;
  93   3            DisplayData[1] = 0x00;
  94   3            DisplayData[2] = DIG_CODE[(35 - Second) % 100 / 10];
  95   3            DisplayData[3] = DIG_CODE[(35 - Second) %10];
  96   3            DisplayData[4] = 0x00;
  97   3            DisplayData[5] = 0x00;
  98   3            DisplayData[6] = DisplayData[2];
  99   3            DisplayData[7] = DisplayData[3];
 100   3            DigDisplay();
 101   3      
 102   3            //--黄灯阶段--//
 103   3      
 104   3            GPIO_TRAFFIC = 0xFF;  //将所有的灯熄灭
 105   3            RED00 = 1;
 106   3            GREEN00 = 1;
 107   3      
 108   3            YELLOW11 = 0;    //宝田路黄灯亮     
 109   3            RED10 = 0;     //宝田路人行道红灯亮
 110   3      
 111   3            YELLOW01 = 0;    //前进路红灯亮
 112   3            RED00 = 0;       //前进路人行道红灯亮
 113   3          }
 114   2      
 115   2          //--前进路通行--//
 116   2          else if(Second < 66) 
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:03:08 PAGE 3   

 117   2          {
 118   3            DisplayData[0] = 0x00;
 119   3            DisplayData[1] = 0x00;
 120   3            DisplayData[2] = DIG_CODE[(65 - Second) % 100 / 10];
 121   3            DisplayData[3] = DIG_CODE[(65 - Second) %10];
 122   3            DisplayData[4] = 0x00;
 123   3            DisplayData[5] = 0x00;
 124   3            DisplayData[6] = DisplayData[2];
 125   3            DisplayData[7] = DisplayData[3];
 126   3            DigDisplay();
 127   3      
 128   3            //--黄灯阶段--//
 129   3      
 130   3            GPIO_TRAFFIC = 0xFF;  //将所有的灯熄灭
 131   3            RED00 = 1;
 132   3            GREEN00 = 1;
 133   3      
 134   3            RED11 = 0;       //宝田路红灯亮     
 135   3            RED10 = 0;       //宝田路人行道红灯亮
 136   3      
 137   3            GREEN01 = 0;     //前进路绿灯亮
 138   3            GREEN00 = 0;     //前进路人行道绿灯亮
 139   3          }
 140   2      
 141   2          //--黄灯等待切换状态，5秒--//
 142   2          else 
 143   2          {
 144   3            DisplayData[0] = 0x00;
 145   3            DisplayData[1] = 0x00;
 146   3            DisplayData[2] = DIG_CODE[(70 - Second) % 100 / 10];
 147   3            DisplayData[3] = DIG_CODE[(70 - Second) %10];
 148   3            DisplayData[4] = 0x00;
 149   3            DisplayData[5] = 0x00;
 150   3            DisplayData[6] = DisplayData[2];
 151   3            DisplayData[7] = DisplayData[3];
 152   3            DigDisplay();
 153   3      
 154   3            //--黄灯阶段--//
 155   3      
 156   3            GPIO_TRAFFIC = 0xFF;  //将所有的灯熄灭
 157   3            RED00 = 1;
 158   3            GREEN00 = 1;
 159   3      
 160   3            YELLOW11 = 0;    //宝田路黄灯亮     
 161   3            RED10 = 0;     //宝田路人行道红灯亮
 162   3      
 163   3            YELLOW01 = 0;    //前进路红灯亮
 164   3            RED00 = 0;       //前进路人行道红灯亮
 165   3          }
 166   2        }       
 167   1      }
 168          
 169          /*******************************************************************************
 170          * 函 数 名         : DigDisplay
 171          * 函数功能       : 使用数码管显示
 172          * 输    入         : 无
 173          * 输    出         : 无
 174          *******************************************************************************/
 175          
 176          void DigDisplay()
 177          {
 178   1        unsigned char i;
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:03:08 PAGE 4   

 179   1        unsigned int j;
 180   1      
 181   1      
 182   1        for(i=0; i<8; i++)
 183   1        {
 184   2          GPIO_PLACE = DIG_PLACE[i];     //发送位选
 185   2          GPIO_DIG = DisplayData[i];     //发送段码
 186   2          j = 10;              //扫描间隔时间设定
 187   2          while(j--); 
 188   2          GPIO_DIG = 0x00;               //消隐
 189   2        }
 190   1      }
 191          
 192          /*******************************************************************************
 193          * 函 数 名         : Timer0Cofig
 194          * 函数功能       : 配置定时器
 195          * 输    入         : 无
 196          * 输    出         : 无
 197          *******************************************************************************/
 198          
 199          void Timer0Cofig(void)
 200          {
 201   1        TMOD = 0x01;     //定时器0选择工作方式1
 202   1          TH0  = 0x3C;   //设置初始值,定时50MS
 203   1          TL0  = 0xB0; 
 204   1          EA   = 1;      //打开总中断
 205   1          ET0  = 1;    //打开定时器0中断
 206   1          TR0  = 1;    //启动定时器0  
 207   1      }
 208          
 209          /*******************************************************************************
 210          * 函 数 名         : Timer0
 211          * 函数功能       : 定时器0中断函数
 212          * 输    入         : 无
 213          * 输    出         : 无
 214          *******************************************************************************/       
 215          
 216          void Timer0() interrupt 1
 217          {
 218   1        TH0 = 0x3C;  //设置初始值
 219   1        TL0 = 0xB0;
 220   1        Time++;
 221   1        if(Time == 20)
 222   1        {
 223   2          Second ++;
 224   2          Time = 0;
 225   2        }
 226   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    294    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
