C51 COMPILER V9.54   MAIN                                                                  07/23/2020 17:57:05 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE src\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\m
                    -ain.lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                            普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名     : NE555脉冲计数显示试验
   6          * 实验说明       : LCD1602显示接收到的脉冲频率。
   7          * 连接方式       : 见连接图
   8          * 注    意     : 
   9          *******************************************************************************/
  10          
  11          #include<reg51.h>
  12          #include"lcd.h"
  13          
  14          #define uchar unsigned char 
  15          #define uint  unsigned int
  16          #define ulong unsigned long
  17          //--定义LCD显示的文字--//
  18          uchar code EN_CHAR1[16]={"   CYMOMETER    "};
  19          uchar code EN_CHAR2[16]={"FREQ:         HZ"};
  20          
  21          //--声明全局函数--//
  22          void TIMER_Configuration(); //初始化定时器
  23          //--定义全局变量--//
  24          ulong Freq;        //用来存放要显示的频率值
  25          ulong TimeCount; //用于计算1S钟的
  26          /*******************************************
  27          *函数名   ：main
  28          *功  能   ：主函数
  29          *输  入   ：无
  30          *输  出   ：无
  31          *******************************************/
  32          
  33          void main()
  34          {
  35   1        uchar i, freqValue[6];
  36   1      
  37   1        LcdInit();
  38   1        TIMER_Configuration();
  39   1      
  40   1        //--显示要写的字母--//
  41   1        for(i=0;i<16;i++)
  42   1        {
  43   2          LcdWriteData(EN_CHAR1[i]);
  44   2        } 
  45   1        LcdWriteCom(0xc0);//第二行显示
  46   1        for(i=0;i<16;i++)
  47   1        {
  48   2          LcdWriteData(EN_CHAR2[i]);
  49   2        }
  50   1        
  51   1        while(1)
  52   1        {
  53   2          if(TR0==0)         //当计数器停下的时候，表明计数完毕
  54   2          {
C51 COMPILER V9.54   MAIN                                                                  07/23/2020 17:57:05 PAGE 2   

  55   3            Freq = Freq + TL1;       //读取TL的值
  56   3            Freq = Freq + (TH1 * 256); //读取TH的值
  57   3            LcdWriteCom(0xc8);
  58   3            //--求频率的个十百千万十万位--//
  59   3            freqValue[0]='0'+Freq%1000000/100000; 
  60   3            freqValue[1]='0'+Freq%100000/10000; 
  61   3            freqValue[2]='0'+Freq%10000/1000; 
  62   3            freqValue[3]='0'+Freq%1000/100; 
  63   3            freqValue[4]='0'+Freq%100/10; 
  64   3            freqValue[5]='0'+Freq%10; 
  65   3            //--显示求得的数值--//
  66   3            for(i=0;i<5;i++)//从最高位开始查找不为0的数开始显示(最低位为0显示0)
  67   3            {
  68   4              if(freqValue[i]==0x30)
  69   4              {
  70   5                freqValue[i]=0x20;  //若为0则赋值空格键
  71   5              }
  72   4                      
  73   4              else
  74   4              {
  75   5                break;
  76   5              }
  77   4                
  78   4            }
  79   3            for(i=0;i<6;i++)
  80   3            {
  81   4              LcdWriteData(freqValue[i]); 
  82   4            }
  83   3            //--显示完，重新计算下一次频率。--//  
  84   3            Freq=0;//将计算的频率清零
  85   3            TH1=0; //将计数器的值清零
  86   3            TL1=0;
  87   3            TR0=1; //开启定时器
  88   3            TR1=1; //开启计数器
  89   3          }
  90   2        }
  91   1      }
  92          
  93          /*******************************************
  94          *函数名   ：TIMER_Configuration
  95          *功  能   ：配置定时/计数器T0和T1
  96          *输  入   ：无
  97          *输  出   ：无
  98          *******************************************/
  99          
 100          void TIMER_Configuration()
 101          {
 102   1        //--定时器T1做计数器，工作方式1（16位定时器），只由TRx打开计数器--//
 103   1        //--定时器T0做定时器，工作方式1（16位定时器），只由TRx打开定时器--//  
 104   1        TMOD=0x51;
 105   1      
 106   1        //--设置定时器晶振为12MHZ时定时50ms--//
 107   1        TH0=0x3C;
 108   1        TL0=0xB0;
 109   1      
 110   1        //--打开中断-//
 111   1        ET0=1;
 112   1        ET1=1;
 113   1        EA=1;
 114   1      
 115   1        //--打开定时器*/
 116   1        TR0=1;
C51 COMPILER V9.54   MAIN                                                                  07/23/2020 17:57:05 PAGE 3   

 117   1        TR1=1;
 118   1      }
 119          /*******************************************
 120          *函数名   ：Timer0
 121          *功  能   ：定时器0的中断函数
 122          *输  入   ：无
 123          *输  出   ：无
 124          *******************************************/
 125          
 126          void Timer0() interrupt 1
 127          {
 128   1        TimeCount++;
 129   1        if(TimeCount==20)//计时到1S
 130   1        {
 131   2          TR0=0;
 132   2          TR1=0;
 133   2          TimeCount=0;    
 134   2        }
 135   1      
 136   1        //--12MHZ设置定时50ms的初值--//
 137   1        TH0=0x3C;
 138   1        TL0=0xB0; 
 139   1      }
 140          /*******************************************
 141          *函数名   ：Timer1
 142          *功  能   ：定时器1的中断函数
 143          *输  入   ：无
 144          *输  出   ：无
 145          *******************************************/
 146          
 147          void Timer1() interrupt 3
 148          { 
 149   1        //--进入一次中断，表明计数到了65536--//
 150   1        Freq=Freq+65536;    
 151   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    568    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
