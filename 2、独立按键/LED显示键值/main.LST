C51 COMPILER V9.56.0.0   MAIN                                                              01/09/2020 21:37:14 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: G:\softs\kile_v5_S\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                            普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名     : LED显示键值实验
   6          * 实验说明       : 8个LED显示读取的8个按键的值
   7          * 连接方式       : 见接线图
   8          * 注    意     : 
   9          *******************************************************************************/
  10          
  11          //--包含你要使用的头文件--//
  12          #include <reg51.h>     //此文件中定义了51的一些特殊功能寄存器
  13          #include <intrins.h>
  14          
  15          //--定义要使用的IO口--//
  16          #define  GPIO_KEY P1  //独立键盘用P1口
  17          #define  GPIO_LED P0  //led使用P0口
  18          
  19          //--定义全局函数--//
  20          void Delay10ms(unsigned int c);   //延时10ms
  21          unsigned char Key_Scan();
  22          
  23          /*******************************************************************************
  24          * 函 数 名         : main
  25          * 函数功能       : 主函数
  26          * 输    入         : 无
  27          * 输    出         : 无
  28          *******************************************************************************/
  29          void main(void)
  30          {
  31   1        unsigned char ledValue, keyNum;
  32   1      
  33   1        ledValue = 0x00;
  34   1      
  35   1        while (1)
  36   1        { 
  37   2          keyNum = Key_Scan();  //扫描键盘
  38   2      
  39   2          if (keyNum != 0)   //有按键按下
  40   2          {
  41   3            ledValue = keyNum;
  42   3          }
  43   2      
  44   2          GPIO_LED = ledValue;//点亮LED灯
  45   2        }       
  46   1      }
  47          /*******************************************************************************
  48          * 函 数 名         : Key_Scan()
  49          * 函数功能       : 扫描键盘
  50          * 输    入         : 无
  51          * 输    出         : 读取到的键值
  52          *******************************************************************************/
  53          
  54          unsigned char Key_Scan()
  55          {
C51 COMPILER V9.56.0.0   MAIN                                                              01/09/2020 21:37:14 PAGE 2   

  56   1        unsigned char keyValue = 0 , i; //保存键值
  57   1      
  58   1        //--检测按键1--//
  59   1        if (GPIO_KEY != 0xFF)   //检测按键K1是否按下
  60   1        {
  61   2          Delay10ms(1); //消除抖动
  62   2      
  63   2          if (GPIO_KEY != 0xFF) //再次检测按键是否按下
  64   2          {
  65   3            keyValue = GPIO_KEY;
  66   3            i = 0;
  67   3            while ((i<50) && (GPIO_KEY != 0xFF))   //检测按键是否松开
  68   3            {
  69   4              Delay10ms(1);
  70   4              i++;
  71   4            }
  72   3          }
  73   2        }
  74   1      
  75   1        return keyValue;   //将读取到键值的值返回
  76   1      }
  77          
  78          /*******************************************************************************
  79          * 函 数 名         : Delay10ms
  80          * 函数功能       : 延时函数，延时10ms
  81          * 输    入         : 无
  82          * 输    出         : 无
  83          *******************************************************************************/
  84          
  85          void Delay10ms(unsigned int c)   //误差 0us
  86          {
  87   1          unsigned char a, b;
  88   1      
  89   1        //--c已经在传递过来的时候已经赋值了，所以在for语句第一句就不用赋值了--//
  90   1          for (;c>0;c--)
  91   1        {
  92   2          for (b=38;b>0;b--)
  93   2          {
  94   3            for (a=130;a>0;a--);
  95   3          }
  96   2                 
  97   2        }       
  98   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     91    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
