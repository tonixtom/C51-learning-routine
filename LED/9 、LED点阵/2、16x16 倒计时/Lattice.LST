C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:04 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LATTICE
OBJECT MODULE PLACED IN Lattice.OBJ
COMPILER INVOKED BY: D:\KEIL\C51\BIN\C51.EXE Lattice.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                                      普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名               : LED点阵数字倒计时
   6          * 实验说明       : 
   7          * 连接方式       : 见接线图
   8          * 注    意               : 
   9          *******************************************************************************/
  10          
  11          #include <REG51.H>
  12          
  13          //--重定义函数变量--//
  14          #define uchar unsigned char
  15          #define uint  unsigned int
  16          #define ulong unsigned long
  17          
  18          //--定义SPI要使用的 IO--//
  19          sbit MOSIO = P3^4;
  20          sbit R_CLK = P3^5;
  21          sbit S_CLK = P3^6;
  22          
  23          //---全局变量声明--//
  24          ulong column;   //点阵列
  25          ulong row;      //点阵行
  26          ulong dt;
  27          
  28          //--点阵显示数组--//
  29          uchar code tab0[] = 
  30          {0x00, 0x01, 0x00, 0x02, 0x00, 0x04, 0x00, 0x08,
  31           0x00, 0x10, 0x00, 0x20, 0x00, 0x40, 0x00, 0x80,
  32           0x01, 0x00, 0x02, 0x00, 0x04, 0x00, 0x08, 0x00,
  33           0x10, 0x00, 0x20, 0x00, 0x40, 0x00, 0x80, 0x00}; 
  34          
  35          //--10字模--//
  36          uchar code tab1[] = 
  37          {0, 0, 0, 0, 0, 0, 8, 24, 14, 36, 8, 66, 8, 66, 8, 66, 
  38           8, 66, 8, 66, 8, 66, 8, 36, 62, 24, 0, 0, 0, 0, 0, 0};
  39          
  40          //--09字模--//
  41          uchar code tab2[] = 
  42          {0, 0, 0, 0, 0, 0, 24, 24, 36, 36, 66, 66, 66, 66, 66,
  43           66, 66, 100, 66, 88, 66, 64, 66, 64, 36, 36, 24, 28, 0, 0, 0, 0} ;
  44          
  45          //--08字模--//
  46          uchar code tab3[] = 
  47          {0, 0, 0, 0, 0, 0, 24, 60, 36, 66, 66, 66, 66, 66, 66, 36,
  48          66, 24, 66, 36, 66, 66, 66, 66, 36, 66, 24, 60, 0, 0, 0, 0};
  49          
  50          //--07字模--//
  51          uchar code tab4[] = 
  52          {0, 0, 0, 0, 0, 0, 24, 126, 36, 34, 66, 34, 66, 16, 66, 16,
  53           66, 8, 66, 8, 66, 8, 66, 8, 36, 8, 24, 8, 0, 0, 0, 0};
  54          
  55          //--06字模--//
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:04 PAGE 2   

  56          uchar code tab5[] = 
  57          {0, 0, 0, 0, 0, 0, 24, 56, 36, 36, 66, 2, 66, 2, 66, 26, 66,
  58           38, 66, 66, 66, 66, 66, 66, 36, 36, 24, 24, 0, 0, 0, 0};
  59          
  60          //--05字模--//
  61          uchar code tab6[] = 
  62          {0, 0, 0, 0, 0, 0, 24, 126, 36, 2, 66, 2, 66, 2, 66, 26, 66,
  63           38, 66, 64, 66, 64, 66, 66, 36, 34, 24, 28, 0, 0, 0, 0};
  64          
  65          //--04字模--//
  66          uchar code tab7[] = 
  67          {0, 0, 0, 0, 0, 0, 24, 32, 36, 48, 66, 40, 66, 36, 66, 36, 66,
  68          34, 66, 34, 66, 126, 66, 32, 36, 32, 24, 120, 0, 0, 0, 0};
  69          
  70          //--03字模--//
  71          uchar code tab8[] = 
  72          {0, 0, 0, 0, 0, 0, 24, 60, 36, 66, 66, 66, 66, 32, 66, 24, 66,
  73           32, 66, 64, 66, 64, 66, 66, 36, 34, 24, 28, 0, 0, 0, 0};
  74          
  75          //--02字模--//
  76          uchar code tab9[] = 
  77          {0, 0, 0, 0, 0, 0, 24, 60, 36, 66, 66, 66, 66, 66, 66, 32, 66,
  78           32, 66, 16, 66, 8, 66, 4, 36, 66, 24, 126, 0, 0, 0, 0};
  79          
  80          //--01字模--//
  81          uchar code tab10[] = 
  82          {0, 0, 0, 0, 0, 0, 24, 8, 36, 14, 66, 8, 66, 8, 66, 8, 66, 8, 66,
  83          8, 66, 8, 66, 8, 36, 8, 24, 62, 0, 0, 0, 0};
  84          
  85          //--00字模--//
  86          uchar code tab11[] = 
  87          {0, 0, 0, 0, 0, 0, 24, 24, 36, 36, 66, 66, 66, 66, 66, 66, 66, 66,
  88          66, 66, 66, 66, 66, 66, 36, 36, 24, 24, 0, 0, 0, 0};
  89          
  90          //--GO--//
  91          uchar code tab12[] = 
  92          {0, 0, 0, 0, 0, 0, 60, 28, 34, 34, 34, 65, 1, 65, 1, 65, 1, 65, 113,
  93           65, 33, 65, 34, 65, 34, 34, 28, 28, 0, 0, 0, 0};
  94          
  95          
  96          //--全局函数声明--//
  97          void HC595SendData(  uchar BT3, uchar BT2,uchar BT1,uchar BT0);
  98                                                                                                                                                                                                  
  99          /*******************************************************************************
 100          * 函 数 名         : main
 101          * 函数功能                 : 主函数
 102          * 输    入         : 无
 103          * 输    出         : 无
 104          *******************************************************************************/
 105          
 106          void main(void)
 107          {
 108   1              int k, i, ms;
 109   1              
 110   1              i = 60;                                 //显示时间                                                                       
 111   1                                                                                                        
 112   1              while(1)
 113   1              {
 114   2                      //--显示10--//
 115   2                      for(ms = i; ms > 0; ms--)
 116   2                      {
 117   3                              for(k = 0; k < 16; k++)                                                                         
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:04 PAGE 3   

 118   3                              {        
 119   4                              HC595SendData(~tab1[2*k +1],~tab1[2*k],tab0[2*k],tab0[2*k + 1]);
 120   4                              }                
 121   3                      }
 122   2              
 123   2                      //--清屏--//
 124   2                      HC595SendData(0xff,0xff,0,0);                                                                                                                                       
 125   2                      
 126   2                      //--显示09--//
 127   2                      for(ms = i; ms > 0; ms--)
 128   2                      {
 129   3                              for(k = 0; k < 16; k++)                                                                                     
 130   3                              {        
 131   4                                      HC595SendData(~tab2[2*k +1],~tab2[2*k],tab0[2*k],tab0[2*k + 1]);                 
 132   4                              }
 133   3                      }
 134   2              
 135   2                      //--清屏--//
 136   2                      HC595SendData(0xff,0xff,0,0);                                                                   
 137   2                      
 138   2                      //--显示08--//
 139   2                      for(ms = i; ms > 0; ms--)
 140   2                      {
 141   3                              for(k = 0; k < 16; k++)                                                                                         
 142   3                              {        
 143   4                                      HC595SendData(~tab3[2*k +1],~tab3[2*k],tab0[2*k],tab0[2*k + 1]);                 
 144   4                              }
 145   3                      }
 146   2                      
 147   2                      //--清屏--//    
 148   2                      HC595SendData(0xff,0xff,0,0);   
 149   2                      
 150   2                      //--显示07--//
 151   2                      for(ms = i; ms > 0; ms--)
 152   2                      {
 153   3                              for(k = 0; k < 16; k++)                                         
 154   3                              {        
 155   4                                      HC595SendData(~tab4[2*k +1],~tab4[2*k],tab0[2*k],tab0[2*k + 1]);                 
 156   4                              }
 157   3                      }
 158   2                      
 159   2                      //--清屏--//    
 160   2                      HC595SendData(0xff,0xff,0,0);                                                                           
 161   2                                                                                                                                                               
 162   2                      //--显示06--//
 163   2                      for(ms = i; ms > 0; ms--)
 164   2                      {
 165   3                              for(k = 0; k < 16; k++)                                                                                         
 166   3                              {        
 167   4                                      HC595SendData(~tab5[2*k +1],~tab5[2*k],tab0[2*k],tab0[2*k + 1]);                 
 168   4                              }
 169   3                      }
 170   2                      
 171   2                      //--清屏--//    
 172   2                      HC595SendData(0xff,0xff,0,0);                                                                           
 173   2              
 174   2                  //--显示05--//
 175   2                      for(ms = i; ms > 0; ms--)
 176   2                      {
 177   3                              for(k = 0; k < 16; k++)                                                                                         //欢
 178   3                              {        
 179   4                                      HC595SendData(~tab6[2*k +1],~tab6[2*k],tab0[2*k],tab0[2*k + 1]);                 
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:04 PAGE 4   

 180   4                              }
 181   3                      }
 182   2      
 183   2                      //--清屏--//    
 184   2                      HC595SendData(0xff,0xff,0,0);                                           
 185   2              
 186   2                  //--显示04--//
 187   2                      for(ms = i; ms > 0; ms--)
 188   2                      {
 189   3                              for(k = 0; k < 16; k++)                                                 
 190   3                              {        
 191   4                                      HC595SendData(~tab7[2*k +1],~tab7[2*k],tab0[2*k],tab0[2*k + 1]);                 
 192   4                              }
 193   3                      }
 194   2      
 195   2                      //--清屏--//    
 196   2                      HC595SendData(0xff,0xff,0,0);                                       
 197   2                      
 198   2                      //--显示03--//
 199   2                      for(ms = i; ms > 0; ms--)
 200   2                      {
 201   3                              for(k = 0; k < 16; k++)                                                 
 202   3                              {        
 203   4                                      HC595SendData(~tab8[2*k +1],~tab8[2*k],tab0[2*k],tab0[2*k + 1]);                 
 204   4                              }
 205   3                      }
 206   2      
 207   2                      //--清屏--//    
 208   2                      HC595SendData(0xff,0xff,0,0);                                                           
 209   2                      
 210   2                      //--显示02--//  
 211   2                      for(ms = i; ms > 0; ms--)
 212   2                      {
 213   3                              for(k = 0; k < 16; k++)                                         
 214   3                              {        
 215   4                                      HC595SendData(~tab9[2*k +1],~tab9[2*k],tab0[2*k],tab0[2*k + 1]);                 
 216   4                              }
 217   3                      }
 218   2      
 219   2                      //--清屏--//    
 220   2                      HC595SendData(0xff,0xff,0,0);                                                                   
 221   2                      
 222   2                      //--显示01--//
 223   2                      for(ms = i; ms > 0; ms--)
 224   2                      {
 225   3                              for(k = 0; k < 16; k++)                                                         
 226   3                              {        
 227   4                                      HC595SendData(~tab10[2*k +1],~tab10[2*k],tab0[2*k],tab0[2*k + 1]);               
 228   4                              }
 229   3                      }
 230   2                      
 231   2                      //--清屏--//    
 232   2                      HC595SendData(0xff,0xff,0,0);                                                                   
 233   2      
 234   2                      //--显示00--//
 235   2                      for(ms = i; ms > 0; ms--)
 236   2                      {
 237   3                              for(k = 0; k < 16; k++)                                                 
 238   3                              {        
 239   4                                      HC595SendData(~tab11[2*k +1],~tab11[2*k],tab0[2*k],tab0[2*k + 1]);               
 240   4                              }
 241   3                      }
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:04 PAGE 5   

 242   2                      //--清屏--//    
 243   2                      HC595SendData(0xff,0xff,0,0);                                                                     //清屏
 244   2              
 245   2                  //--一直显示G0--//
 246   2                      while(1)
 247   2                      {
 248   3                              for(k = 0; k < 16; k++)                                                                                         //中
 249   3                              {        
 250   4                                      HC595SendData(~tab12[2*k +1],~tab12[2*k],tab0[2*k],tab0[2*k + 1]);               
 251   4                              }                               
 252   3                      }                                                                       
 253   2              }
 254   1      }
 255          /*******************************************************************************
 256          * 函 数 名         : HC595SendData
 257          * 函数功能                 : 通过595发送四个字节的数据
 258          * 输    入         : BT3：第四个595输出数值
 259          *                  * BT2: 第三个595输出数值
 260          *                  * BT1：第二个595输出数值
 261          *                  * BT0：第一个595输出数值
 262          * 输    出         : 无
 263          *******************************************************************************/
 264          
 265          void HC595SendData(  uchar BT3, uchar BT2,uchar BT1,uchar BT0)
 266          {  
 267   1              uchar i;
 268   1              
 269   1              //--发送第一个字节--//
 270   1              for(i=0;i<8;i++)
 271   1              {
 272   2                      MOSIO = BT3 >> 7 ;      //从高位到低位
 273   2                      BT3 <<= 1;
 274   2      
 275   2                      S_CLK = 0;
 276   2                      S_CLK = 1;              
 277   2              }
 278   1      
 279   1              //--发送第一个字节--//
 280   1              for(i=0;i<8;i++)
 281   1              {
 282   2                      MOSIO = BT2 >>7;                //从高位到低位
 283   2                      BT2 <<= 1;
 284   2      
 285   2                      S_CLK = 0;
 286   2                      S_CLK = 1;      
 287   2              }
 288   1      
 289   1              //--发送第一个字节--//
 290   1              for(i=0;i<8;i++)
 291   1              {
 292   2                      MOSIO = BT1 >> 7;               //从高位到低位
 293   2                      BT1 <<= 1;
 294   2                      S_CLK = 0;
 295   2                      S_CLK = 1;      
 296   2              }
 297   1      
 298   1              //--发送第一个字节--//
 299   1              for(i=0;i<8;i++)
 300   1              {
 301   2                      MOSIO = BT0 >> 7;               //从高位到低位
 302   2                      BT0 <<= 1;
 303   2                      S_CLK = 0;
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:04 PAGE 6   

 304   2                      S_CLK = 1;
 305   2              }
 306   1         
 307   1              //--输出--//
 308   1              R_CLK = 0; //set dataline low
 309   1              R_CLK = 1; //片选
 310   1              R_CLK = 0; //set dataline low
 311   1      }
 312          
 313          
 314          
 315          
 316          
 317          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1726    ----
   CONSTANT SIZE    =    416    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
