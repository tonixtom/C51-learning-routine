C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:44 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LATTICE
OBJECT MODULE PLACED IN Lattice.OBJ
COMPILER INVOKED BY: D:\KEIL\C51\BIN\C51.EXE Lattice.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                                      普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名               : 使用C语言指针显示汉字
   6          * 实验说明       : 
   7          * 连接方式       : 见接线图
   8          * 注    意               : 
   9          *******************************************************************************/
  10          
  11          #include <REG51.H>
  12          #include "array.h"
  13          
  14          //--重定义函数变量--//
  15          #define uchar unsigned char
  16          #define uint  unsigned int
  17          #define ulong unsigned long
  18          
  19          //--定义SPI要使用的 IO--//
  20          sbit MOSIO = P3^4;
  21          sbit R_CLK = P3^5;
  22          sbit S_CLK = P3^6;
  23          
  24          //--全局函数声明--//
  25          void HC595SendData(  uchar BT3, uchar BT2,uchar BT1,uchar BT0);
  26                                                                                                                                                                                                  
  27          /*******************************************************************************
  28          * 函 数 名         : main
  29          * 函数功能                 : 主函数
  30          * 输    入         : 无
  31          * 输    出         : 无
  32          *******************************************************************************/
  33          
  34          void main(void)
  35          {   
  36   1         int k, i, ms;
  37   1      
  38   1         //--定义一个指针数据指向汉字--//
  39   1         uchar *p[] = { 
  40   1                                       tab1, tab2, tab3, tab4, tab5, tab6, tab7, tab8,
  41   1                                       tab9, tab10, tab11, tab12, tab13, tab14, tab15};                                               
  42   1              while(1)
  43   1              {
  44   2                      for(i = 0; i < 15; i++)         //总共15个字
  45   2                      {
  46   3                              for(ms = 50; ms > 0; ms--)      //显示50次，即肉眼可识别的停留时间
  47   3                              {
  48   4                                      for(k = 0; k < 16; k++)                 //显示一个字
  49   4                                      {                                                       
  50   5                                              //--因为字模软件取的数组是高电平有效，所以列要取反--//
  51   5                                              HC595SendData(~(*(p[i] + 2*k + 1)),~(*(p[i] + 2*k )),
  52   5                                                             tab0[2*k],tab0[2*k + 1]); 
  53   5                                      }
  54   4      
  55   4                                      HC595SendData(0xff,0xff,0,0);                           //清屏           
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:44 PAGE 2   

  56   4                              }
  57   3                      }                                                                         
  58   2              }
  59   1      }
  60          
  61          /*******************************************************************************
  62          * 函 数 名         : HC595SendData
  63          * 函数功能                 : 通过595发送四个字节的数据
  64          * 输    入         : BT3：第四个595输出数值
  65          *                  * BT2: 第三个595输出数值
  66          *                  * BT1：第二个595输出数值
  67          *                  * BT0：第一个595输出数值
  68          * 输    出         : 无
  69          *******************************************************************************/
  70          
  71          void HC595SendData(  uchar BT3, uchar BT2,uchar BT1,uchar BT0)
  72          {  
  73   1              uchar i;
  74   1              
  75   1              //--发送第一个字节--//
  76   1              for(i=0;i<8;i++)
  77   1              {
  78   2                      MOSIO = BT3 >> 7 ;      //从高位到低位
  79   2                      BT3 <<= 1;
  80   2      
  81   2                      S_CLK = 0;
  82   2                      S_CLK = 1;              
  83   2              }
  84   1      
  85   1              //--发送第一个字节--//
  86   1              for(i=0;i<8;i++)
  87   1              {
  88   2                      MOSIO = BT2 >>7;                //从高位到低位
  89   2                      BT2 <<= 1;
  90   2      
  91   2                      S_CLK = 0;
  92   2                      S_CLK = 1;      
  93   2              }
  94   1      
  95   1              //--发送第一个字节--//
  96   1              for(i=0;i<8;i++)
  97   1              {
  98   2                      MOSIO = BT1 >> 7;               //从高位到低位
  99   2                      BT1 <<= 1;
 100   2                      S_CLK = 0;
 101   2                      S_CLK = 1;      
 102   2              }
 103   1      
 104   1              //--发送第一个字节--//
 105   1              for(i=0;i<8;i++)
 106   1              {
 107   2                      MOSIO = BT0 >> 7;               //从高位到低位
 108   2                      BT0 <<= 1;
 109   2                      S_CLK = 0;
 110   2                      S_CLK = 1;
 111   2              }
 112   1         
 113   1              //--输出--//
 114   1              R_CLK = 0; //set dataline low
 115   1              R_CLK = 1; //片选
 116   1              R_CLK = 0; //set dataline low
 117   1      }
C51 COMPILER V9.01   LATTICE                                                               01/14/2014 09:34:44 PAGE 3   

 118          
 119          
 120          
 121          
 122          
 123          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    342    ----
   CONSTANT SIZE    =    557    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      55
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
