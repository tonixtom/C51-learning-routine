C51 COMPILER V9.54   232                                                                   07/10/2020 15:47:22 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 232
OBJECT MODULE PLACED IN 232.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE 232.c OPTIMIZE(8,SPEED) BROWSE INCDIR(C:\Keil_v5\C51) DEBUG OBJECTEXTEND
                    - TABS(2)

line level    source

   1           /*******************************************************************************
   2          *  标题:                  RS485串口通信试验(接受与发送)                         *
   3          *                                         *
   4          *  1.通过本例程了解串口的基本原理及使用 ,理解并掌握对串口进行初始化         *
   5          *                                       *
   6          *  2.请使用串口调试助手（Baud 4800、数据位8、停止位1、效验位无）做为上位机(发送)数据和(接受)数据，
   7          *    请在字符串输入框中输入字符和数字(HEX),按发送按钮。观看接受窗显示情况.也可以用自动循环发送。
   8          *
   9          *  3.试验RS485需要用RS232转485的转换头。开板A对485转换头A  B对应485转换头B.接法大家可以参考原理图。
  10          *                                                                                 *
  11          * 请学员认真消化本例程，学会用C语言操作串口和485的实现                        *
  12          ********************************************************************************/
  13          
  14          #include <REG52.H>
  15          #include <stdio.h>
  16          
  17          //sbit RS485E=P3^7;   //定义485的使能脚
  18          sbit RS485E=P1^2;   //定义485的使能脚
  19          bit SendFlag;
  20          unsigned int ReData,SenData;
  21          
  22          /**************************************
  23                延时程序
  24          **************************************/
  25          void delay(unsigned char i)
  26          {
  27   1        unsigned char j;
  28   1        for(i; i > 0; i--)
  29   1          for(j = 200; j > 0; j--);
  30   1      }
  31          
  32          
  33          void main (void) {
  34   1      
  35   1      
  36   1              SCON = 0x50;      //REN=1允许串行接受状态，串口工作模式1                 
  37   1            TMOD|= 0x20;      //定时器工作方式2                    
  38   1          PCON|= 0x80;                                                          
  39   1          TH1  = 0xFd;     //baud*2  /* reload value 19200、数据位8、停止位1。效验位无 (11.0592)   
  40   1          //TH1 = 0xF3;  // //baud*2  /*  波特率4800、数据位8、停止位1。效验位无 (12M)
  41   1            TL1 = 0xF3;       
  42   1          TR1  = 1;                                                             
  43   1          ES   = 1;        //开串口中断                  
  44   1          EA   = 1;        // 开总中断 
  45   1        
  46   1           // IE = 0x0;
  47   1        SenData = 1;
  48   1         
  49   1        while(1)
  50   1          { 
  51   2        
  52   2          if (SendFlag==1)    // max485(半双工通信) RE/DE定义 RE=0为接受状态  DE=1为发送状态(参考MAX485芯片管脚)
  53   2            {   RS485E=1;     //                              RS5485E=0为接收状态  RS5485E=1为发送状态
  54   3              SBUF=SenData;    //发送数据
C51 COMPILER V9.54   232                                                                   07/10/2020 15:47:22 PAGE 2   

  55   3            delay(50);
  56   3             }
  57   2         else
  58   2          {
  59   3      
  60   3              RS485E=0;       //接收状态
  61   3          }
  62   2      
  63   2       }
  64   1       
  65   1      }
  66          
  67          /****************************************************
  68                         串口中断程序
  69          ******************************************************/
  70          void ser_int (void) interrupt 4 using 1
  71          {
  72   1       if(TI == 1)
  73   1       {
  74   2        TI = 0;
  75   2        SendFlag = 0;
  76   2       }
  77   1      
  78   1       if(RI == 1)        //RI接受中断标志
  79   1       {
  80   2        RI = 0;       //清除RI接受中断标志
  81   2        ReData = SBUF;  //SUBF接受/发送缓冲器
  82   2        SenData=ReData;
  83   2        SendFlag = 1;
  84   2          
  85   2       }
  86   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     95    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
