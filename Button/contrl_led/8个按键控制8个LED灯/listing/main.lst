C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:41:21 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\main.
                    -lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                            普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名     : 独立按键控制LED实验
   6          * 实验说明       : 每个按键控制一个LED
   7          * 连接方式       : 见接线图
   8          * 注    意     : 
   9          *******************************************************************************/
  10          
  11          //--包含你要使用的头文件--//
  12          #include <reg51.h>     //此文件中定义了51的一些特殊功能寄存器
  13          #include <intrins.h>
  14          
  15          //--定义要使用的IO口--//
  16          #define  GPIO_KEY P1  //独立键盘用P1口
  17          #define  GPIO_LED P0  //led使用P0口
  18          
  19          //--声明全局函数--//
  20          void Delay10ms(unsigned int c);   //延时10ms
  21          unsigned char Key_Scan();
  22          
  23          /*******************************************************************************
  24          * 函 数 名         : main
  25          * 函数功能       : 主函数
  26          * 输    入         : 无
  27          * 输    出         : 无
  28          *******************************************************************************/
  29          void main(void)
  30          {
  31   1        unsigned char ledValue, keyNum;
  32   1      
  33   1        ledValue = 0x01;
  34   1      
  35   1        while (1)
  36   1        { 
  37   2          keyNum = Key_Scan();  //扫描键盘
  38   2      
  39   2          switch (keyNum)
  40   2          {
  41   3            case(0xFE) :    //返回按键K1的数据
  42   3              ledValue = 0x01;
  43   3              break;
  44   3            case(0xFD) :    //返回按键K2的数据
  45   3              ledValue = 0x02;
  46   3              break;
  47   3            case(0xFB) :    //返回按键K3的数据
  48   3              ledValue = 0x04;
  49   3              break;
  50   3            case(0xF7) :    //返回按键K4的数据
  51   3              ledValue = 0x08;
  52   3              break;
  53   3            case(0xEF) :    //返回按键K5的数据
  54   3              ledValue = 0x10;
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:41:21 PAGE 2   

  55   3              break;
  56   3            case(0xDF) :    //返回按键K6的数据
  57   3              ledValue = 0x20;
  58   3              break;
  59   3            case(0xBF) :    //返回按键K7的数据
  60   3              ledValue = 0x40;
  61   3              break;
  62   3            case(0x7F) :    //返回按键K8的数据
  63   3              ledValue = 0x80;
  64   3              break;
  65   3            default:
  66   3              break;
  67   3          }
  68   2      
  69   2          GPIO_LED = ledValue;//点亮LED灯
  70   2        }       
  71   1      }
  72          
  73          /*******************************************************************************
  74          * 函 数 名         : Key_Scan()
  75          * 函数功能       : 扫描键盘
  76          * 输    入         : 无
  77          * 输    出         : 读取到的键值
  78          *******************************************************************************/
  79          
  80          unsigned char Key_Scan()
  81          {
  82   1        unsigned char keyValue = 0 , i; //保存键值
  83   1      
  84   1        //--检测按键1--//
  85   1        if (GPIO_KEY != 0xFF)   //检测按键K1是否按下
  86   1        {
  87   2          Delay10ms(1); //消除抖动
  88   2      
  89   2          if (GPIO_KEY != 0xFF) //再次检测按键是否按下
  90   2          {
  91   3            keyValue = GPIO_KEY;
  92   3            i = 0;
  93   3            while ((i<50) && (GPIO_KEY != 0xFF))   //检测按键是否松开
  94   3            {
  95   4              Delay10ms(1);
  96   4              i++;
  97   4            }
  98   3          }
  99   2        }
 100   1      
 101   1        return keyValue;   //将读取到键值的值返回
 102   1      }
 103          
 104          /*******************************************************************************
 105          * 函 数 名         : Delay10ms
 106          * 函数功能       : 延时函数，延时10ms
 107          * 输    入         : 无
 108          * 输    出         : 无
 109          *******************************************************************************/
 110          
 111          void Delay10ms(unsigned int c)   //误差 0us
 112          {
 113   1          unsigned char a, b;
 114   1      
 115   1        //--c已经在传递过来的时候已经赋值了，所以在for语句第一句就不用赋值了--//
 116   1          for (;c>0;c--)
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:41:21 PAGE 3   

 117   1        {
 118   2          for (b=38;b>0;b--)
 119   2          {
 120   3            for (a=130;a>0;a--);
 121   3          }
 122   2                 
 123   2        }       
 124   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    156    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
