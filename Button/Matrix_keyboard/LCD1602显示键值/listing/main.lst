C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:42:26 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE code\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\listing\
                    -main.lst) TABS(2) OBJECT(.\output\main.obj)

line level    source

   1          /*******************************************************************************
   2          *                 
   3          *                            普中科技
   4          --------------------------------------------------------------------------------
   5          * 实 验 名     : 矩阵键盘显示试验
   6          * 实验说明       : LCD1602显示读取到的键值
   7          * 连接方式       : 见连接图
   8          * 注    意     : 
   9          *******************************************************************************/
  10          #include<reg51.h> 
  11          #include"lcd.h"
  12          
  13          //--定义使用的IO口--//  
  14          #define GPIO_KEY P1
  15          
  16          //--定义全局变量--//
  17          unsigned char PuZh[17]="The key value is:";
  18          unsigned char KeyValue;
  19          //用来存放读取到的键值
  20          
  21          //--声明全局函数--//
  22          void KeyScan(void);
  23          void Delay10ms(unsigned int c);   //误差 0us
  24          
  25          /*******************************************************************************
  26          * 函 数 名         : main
  27          * 函数功能       : 主函数
  28          * 输    入         : 无
  29          * 输    出         : 无
  30          *******************************************************************************/
  31          void main(void)
  32          {
  33   1        unsigned char i;
  34   1        LcdInit();
  35   1        for(i=0; i<17; i++)
  36   1        {   
  37   2          if(i == 14)
  38   2          {
  39   3            LcdWriteCom(0x80 + 0x40);
  40   3          }
  41   2          LcdWriteData(PuZh[i]);      
  42   2        }
  43   1        while(1)
  44   1        {
  45   2          KeyScan();
  46   2          LcdWriteCom(0x80 + 0x44);
  47   2          if(KeyValue < 10)
  48   2          {
  49   3              LcdWriteData('0' + KeyValue);
  50   3          }
  51   2          else
  52   2          {
  53   3            LcdWriteData('7' + KeyValue); //A的ASCII码的前10位是7，所以用7做基数  
  54   3          } 
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:42:26 PAGE 2   

  55   2        }       
  56   1      }
  57          
  58          /*******************************************************************************
  59          * 函 数 名         : KeyScan
  60          * 函数功能       : 检测有按键按下并读取键值
  61          * 输    入         : 无
  62          * 输    出         : 无
  63          *******************************************************************************/
  64          
  65          void KeyScan(void)
  66          {
  67   1        char a = 0;
  68   1        GPIO_KEY=0x0f;
  69   1        if(GPIO_KEY!=0x0f)//读取按键是否按下
  70   1        {
  71   2          Delay10ms(1);//延时10ms进行消抖
  72   2          if(GPIO_KEY!=0x0f)//再次检测键盘是否按下
  73   2          {
  74   3            
  75   3            //测试列
  76   3            GPIO_KEY=0X0F;
  77   3            switch(GPIO_KEY)
  78   3            {
  79   4              case(0X07): KeyValue=0;break;
  80   4              case(0X0b): KeyValue=4;break;
  81   4              case(0X0d): KeyValue=8;break;
  82   4              case(0X0e): KeyValue=12;break;
  83   4            }
  84   3            //测试行
  85   3            GPIO_KEY=0XF0;
  86   3            switch(GPIO_KEY)
  87   3            {
  88   4              case(0X70): KeyValue=KeyValue+3;break;
  89   4              case(0Xb0): KeyValue=KeyValue+2;break;
  90   4              case(0Xd0): KeyValue=KeyValue+1;break;
  91   4              case(0Xe0): KeyValue=KeyValue;break;
  92   4            }
  93   3            while((a<50) && (GPIO_KEY!=0xf0))  //检测按键松手检测
  94   3            {
  95   4              Delay10ms(1);
  96   4              a++;
  97   4            }
  98   3          }
  99   2        }
 100   1      }
 101          
 102          /*******************************************************************************
 103          * 函 数 名         : Delay10ms
 104          * 函数功能       : 延时函数，延时10ms
 105          * 输    入         : 无
 106          * 输    出         : 无
 107          *******************************************************************************/
 108          
 109          void Delay10ms(unsigned int c)   //误差 0us
 110          {
 111   1          unsigned char a, b;
 112   1      
 113   1        //--c已经在传递过来的时候已经赋值了，所以在for语句第一句就不用赋值了--//
 114   1          for (;c>0;c--)
 115   1        {
 116   2          for (b=38;b>0;b--)
C51 COMPILER V9.54   MAIN                                                                  07/29/2020 11:42:26 PAGE 3   

 117   2          {
 118   3            for (a=130;a>0;a--);
 119   3          }          
 120   2        }       
 121   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    229    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     18       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
